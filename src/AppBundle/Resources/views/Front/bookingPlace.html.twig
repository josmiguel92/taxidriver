{% extends 'AppBundle:Front:baseBooking.html.twig' %}


{% set title = "Book a Taxi to "%}
{% if locale=='es' %}
    {% set title = "Reservar un Taxi para " %}
{% endif %}

{% set title = title~place.getNameLocale %}

{% set featureImage =  asset(place.getWideImageWebPath) %}

{% set spanish_page = path("booking_place", {"_locale":"es", "_id":place.getId,  "_name":place.getName}) %}
{% set english_page = path("booking_place", {"_locale":"en", "_id":place.getId, "_name":place.getNameEn}) %}

{% block hreflang %}
    <link rel="alternate" hreflang="en" href="{{ absolute_url(english_page) }}" />
    <link rel="alternate" hreflang="es" href="{{ absolute_url(spanish_page) }}" />
    <link rel="alternate" hreflang="x-default" href="{{ absolute_url(english_page) }}" />
{% endblock %}

{% block structure_data %}
    {#breadcrumbs#}
    <script type="application/ld+json">
        {
          "@context": "http://schema.org",
          "@type": "BreadcrumbList",
          "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
              "@id": "{{ absolute_url(path("home")) }}",
              "name": "Home",
              "image": "{{ asset("/images/favicon.png") }}"
            }
          }
          {
            "@type": "ListItem",
            "position": 2,
            "item": {
              "@id": "{{ absolute_url(english_page) }}",
              "name": "{{ place.getNameEn }}",
              "image": "{{ asset("/images/favicon.png") }}"
            }
          }]
        }
    </script>

    <script type="application/ld+json">
        {
            "@context": "http://schema.org/",
            "@type": "Product",
            {% if not place.istour %}
                "name": "Taxi to {{ place.getNameEn }}",
            {% else %}
                "name": "Tour or Taxi to {{ place.getNameEn }}",
            {% endif %}
            "image": [
            "{{ absolute_url(asset(place.getWebPath("full-1x1"))) }}",
            "{{ absolute_url(asset(place.getWebPath("full-4x3"))) }}",
            "{{ absolute_url(asset(place.getWebPath("full-16x9"))) }}"
            ],
        {% if not place.istour %}
            "description": "Taxi to {{ place.getNameEn }}",
        {% else %}
            "description": "Taxi Tour to {{ place.getNameEn }}",
        {% endif %}
            "mpn": "",
            "brand": {
                "@type": "Thing",
                "name": "Taxi Drivers Cuba"
            },
            "offers": {
                "@type": "Offer",
                "priceCurrency": "USD",
                "price": "{{ (place.getTrasferprice / config['tasa.usd']) | number_format(2,'.') }}",
                "priceValidUntil": "2018-12-31",
                "itemCondition": "http://schema.org/UsedCondition",
                "availability": "http://schema.org/InStock",
                "seller": {
                    "@type": "Organization",
                    "name": "Taxi Drivers Cuba"
                    }
                }
        }
        </script>
{% endblock %}

{% if locale=='es' %}
    {% set description = 'Reserva ahora un taxi para '~place.getNameLocale~' el cual es uno de los lugares maravillosos de nuestra isla. '~content.getReservationDescriptionLocale %}
{% else %}
    {% set description = 'Book now a taxi for '~place.getNameLocale~' wich is one of the most wonderful place of our island. '~content.getReservationDescriptionLocale %}
{% endif %}


{% block destination %}
<!--- Parallax -->
    <div class="booking-place context-dark offset-top-0" style="margin-top: -8px;">
        <!-- RD Parallax-->
        <div data-on="false" data-md-on="true" class="rd-parallax">
            <div data-speed="0.25" data-type="media" data-url="{{ asset(place.getWideImageWebPath) }}" class="rd-parallax-layer"></div>
            <div data-speed="0" data-type="html" data-md-fade="false" class="rd-parallax-layer">
                <div class="shell section-75 section-md-top-103 section-md-bottom-110">
                    <div class="range range-xs-center">
                        <div class="cell-sm-10">

                            <div class="offset-top-60 offset-md-top-30">

                                <h2 class=" h1 text-center text-spacing-0 text-uppercase" style="border-radius: 5px;">
                                    {{ place.getNameLocale }}
                                </h2>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
{{ parent() }}

    <script>
        increment = {{ config['price.increment'] }};

        function wrapperPrice(price)
        {
            if (typeof(price)=="number")
                return '<i class=\'fa fa-dollar color-sky\'></i> '+price+' CUC';
            else
                return "{% trans %}We need to negotiate {% endtrans %} <span class=\"text-extra-small\">*</span>";
            return price;
        }

        function updatePrice()
        {
            var tourPrice = {{ place.getPrice }};
            var transferPrice = {{ place.getTrasferprice }};
            var isTour = {{ place.isTour? "true":"false" }};

            if (isTour){
                if (buttonTourOn && numberPeople <= 3)
                    priceContent = wrapperPrice(tourPrice);
                if (!buttonTourOn && numberPeople <= 3)
                    priceContent = wrapperPrice(transferPrice);
                if (buttonTourOn && numberPeople > 3)
                    priceContent = wrapperPrice(tourPrice+increment*(numberPeople-3));
                if (!buttonTourOn && numberPeople > 3)
                    priceContent = wrapperPrice(transferPrice+increment*(numberPeople-3));

                if (!buttonTourOn && buttonReturnOn){
                    if (numberPeople <= 3)
                        priceContent = wrapperPrice(2*transferPrice);
                    if (numberPeople > 3)
                        priceContent = wrapperPrice(2*(transferPrice+increment*(numberPeople-3)));
                }
            }
            else if (buttonReturnOn){
                if (numberPeople <= 3)
                    priceContent = wrapperPrice(2*transferPrice);
                if (numberPeople > 3)
                    priceContent = wrapperPrice(2*(transferPrice+increment*(numberPeople-3)));
            }
            else{
                if (numberPeople <= 3)
                    priceContent = wrapperPrice(transferPrice);
                if (numberPeople > 3)
                    priceContent = wrapperPrice(transferPrice+increment*(numberPeople-3));
            }

            //vinnales hard-coded
            {% if "vi√±ales" in place.nameLocale|lower or "vinales" in place.nameLocale|lower %}
                if (buttonTourOn && numberPeople <= 3)
                    priceContent = wrapperPrice(135);
                if (buttonTourOn && numberPeople > 3)
                    priceContent = wrapperPrice(160);
            {% endif %}


            if (numberPeople > 5)
                priceContent = wrapperPrice("");

            $("#labelPrice")[0].innerHTML = priceContent;
        }


        $("#document").ready(function (){
            updatePrice();

            $("#activeTour").change(function() {
                updatePrice();
            });

            $("#activeReturn").change(function() {
                updatePrice();
            });

            $("#{{ booking_form.numpeople.vars.id }}").change(function() {
              updatePrice();
            });

            {% if place.isTour %}
                {#Como es un tour mostrar el toggle del tour
                y anadir la descripcion del lugar.#}
                $("#tourToggle").fadeIn(500);
                $("#tourTitle")[0].innerHTML = "{{ place.nameLocale }}";
                $("#tourDescription")[0].innerHTML = "{{ place.getPlaceDescLocale | replace({"\n":"<br>", '\r':''}) | raw }}";
            {% endif %}

            activeOrDeactiveReturn();
            $("#returnLine").fadeIn(500);
            $("#returnToggle").fadeIn(500);
            $("#returnPlace").fadeIn(500);
            $("#returnTime").fadeIn(500);
        });

    </script>

{% endblock %}